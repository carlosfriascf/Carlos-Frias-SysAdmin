user nginx;
worker_processes auto;
worker_rlimit_nofile 65535;
timer_resolution 30ms;
error_log /var/log/nginx/error.log notice;
pid /var/run/nginx.pid;
events {
use epoll;
multi_accept on;
worker_connections 65535;
}
http {
sendfile on;
tcp_nopush on;
charset utf-8;
access_log off;
tcp_nodelay on;
send_timeout 15;
log_not_found off;
server_tokens off;
keepalive_timeout 5;
keepalive_requests 150;
client_body_timeout 5s;
if_modified_since before;
types_hash_max_size 2048;
client_header_timeout 5s;
ignore_invalid_headers on;
client_max_body_size 1200m;
server_name_in_redirect off;
reset_timedout_connection on;
include /etc/nginx/mime.types;
client_body_buffer_size 2048k;
disable_symlinks if_not_owner;
server_names_hash_max_size 2048;
server_names_hash_bucket_size 64;
more_set_headers 'Server: Sysdop';
default_type application/octet-stream;
log_format main '$remote_addr - $remote_user [$time_local] $request '
'"$status" $body_bytes_sent "$http_referer" '
'"$http_user_agent" "$http_x_forwarded_for"'
'$request_time $upstream_response_time $pipe';
log_format bytes '$body_bytes_sent';
client_body_temp_path /var/lib/nginx/cache/client_body 1 2;
gzip on;
gzip_disable "MSIE [1-6]\.";
gzip_static on;
gzip_comp_level 9;
gzip_http_version 1.1;
gzip_proxied any;
gzip_vary on;
gzip_buffers 16 8k;
gzip_min_length 1100;
gzip_types
text/css
text/xml
text/mathml
text/plain
text/x-component
text/cache-manifest
text/javascript
text/vcard
text/vtt
text/x-js
font/opentype
image/bmp
image/gif
image/jpeg
image/png
image/svg+xml
image/tiff
image/webp
image/x-icon
image/x-jng
image/x-ms-bmp
application/javascript
application/atom+xml
application/rss+xml
application/font-woff
application/java-archive
application/json
application/msword
application/pdf
application/postscript
application/rtf
application/x-7z-compressed
application/x-cocoa
application/x-java-archive-diff
application/x-java-jnlp-file
application/x-makeself
application/x-perl
application/x-pilot
application/x-rar-compressed
application/x-sea
application/x-shockwave-flash
application/x-stuffit
application/x-tcl
application/x-xpinstall
application/xhtml+xml
application/xspf+xml
application/zip
application/ld+json
application/manifest+json
application/x-font-ttf
application/x-javascript
application/x-web-app-manifest+json
application/xml
application/xml+rss
application/x-font-opentype
application/atom_xml
text/comma-separated-values
application/vnd.ms-fontobject
font/truetype;
brotli on;
brotli_static on;
brotli_buffers 16 8k;
brotli_comp_level 6;
brotli_types
text/css
text/xml
text/mathml
text/plain
text/x-component
text/cache-manifest
text/javascript
text/vcard
text/vtt
text/x-js
font/opentype
image/bmp
image/gif
image/jpeg
image/png
image/svg+xml
image/tiff
image/webp
image/x-icon
image/x-jng
image/x-ms-bmp
application/javascript
application/atom+xml
application/rss+xml
application/font-woff
application/java-archive
application/json
application/msword
application/pdf
application/postscript
application/rtf
application/x-7z-compressed
application/x-cocoa
application/x-java-archive-diff
application/x-java-jnlp-file
application/x-makeself
application/x-perl
application/x-pilot
application/x-rar-compressed
application/x-sea
application/x-shockwave-flash
application/x-stuffit
application/x-tcl
application/x-xpinstall
application/xhtml+xml
application/xspf+xml
application/zip
application/ld+json
application/manifest+json
application/x-font-ttf
application/x-javascript
application/x-web-app-manifest+json
application/xml
application/xml+rss
application/x-font-opentype
application/atom_xml
text/comma-separated-values
application/vnd.ms-fontobject
font/truetype;
proxy_redirect off;
proxy_set_header Host $host;
proxy_set_header Upgrade $http_upgrade;
proxy_set_header Referer $http_referer;
proxy_set_header X-Forwarded-Host $host;
proxy_set_header X-Real-IP $remote_addr;
proxy_set_header X-Forwarded-Server $host;
proxy_set_header REMOTE_ADDR $remote_addr;
proxy_set_header X-Forwarded-Proto $scheme;
proxy_set_header CF-Visitor $http_cf_visitor;
proxy_set_header X-Forwarded-Port $server_port;
proxy_set_header CF-Connecting-IP $http_cf_connecting_ip;
proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
pagespeed off;
pagespeed FileCachePath /var/lib/nginx/cache/pagespeed;
pagespeed MemcachedThreads 1;
pagespeed MemcachedServers "localhost:11211";
pagespeed LowercaseHtmlNames on;
pagespeed StatisticsPath /ngx_pagespeed_statistics;
pagespeed GlobalStatisticsPath /ngx_pagespeed_global_statistics;
pagespeed MessagesPath /ngx_pagespeed_message;
pagespeed ConsolePath /pagespeed_console;
pagespeed AdminPath /pagespeed_admin;
pagespeed GlobalAdminPath /pagespeed_global_admin;
pagespeed UsePerVhostStatistics on;
pagespeed FetchHttps enable;
pagespeed FetchHttps enable,allow_self_signed;
pagespeed EnableCachePurge on;
pagespeed InPlaceResourceOptimization on;
pagespeed FetchWithGzip on;
pagespeed RespectVary on;
pagespeed CombineAcrossPaths on;
pagespeed DisableFilters convert_jpeg_to_webp,convert_to_webp_lossless,convert_to_webp_animated,recompress_webp;
pagespeed EnableFilters collapse_whitespace;
pagespeed EnableFilters remove_comments;
proxy_pass_header Set-Cookie;
resolver 1.1.1.1 valid=30s;
resolver_timeout 5s;
set_real_ip_from ::1;
set_real_ip_from 127.0.0.1;
set_real_ip_from 103.21.244.0/22;
set_real_ip_from 103.22.200.0/22;
set_real_ip_from 103.31.4.0/22;
set_real_ip_from 104.16.0.0/12;
set_real_ip_from 108.162.192.0/18;
set_real_ip_from 131.0.72.0/22;
set_real_ip_from 141.101.64.0/18;
set_real_ip_from 162.158.0.0/15;
set_real_ip_from 172.64.0.0/13;
set_real_ip_from 173.245.48.0/20;
set_real_ip_from 188.114.96.0/20;
set_real_ip_from 190.93.240.0/20;
set_real_ip_from 197.234.240.0/22;
set_real_ip_from 198.41.128.0/17;
set_real_ip_from 2400:cb00::/32;
set_real_ip_from 2405:8100::/32;
set_real_ip_from 2405:b500::/32;
set_real_ip_from 2606:4700::/32;
set_real_ip_from 2803:f800::/32;
set_real_ip_from 2c0f:f248::/32;
set_real_ip_from 2a06:98c0::/29;
set_real_ip_from 192.88.134.0/23;
set_real_ip_from 185.93.228.0/22;
set_real_ip_from 66.248.200.0/22;
set_real_ip_from 2a02:fe80::/29;
real_ip_header X-Forwarded-For;
real_ip_recursive on;
proxy_cache_path /var/lib/nginx/cache/proxy levels=1:2 keys_zone=PROXYCACHE:100m max_size=1200m inactive=60m;
proxy_temp_path /var/lib/nginx/cache/proxy_tmp;
proxy_connect_timeout 30;
proxy_read_timeout 30;
proxy_send_timeout 30;
proxy_buffers 16 32k;
proxy_buffering on;
proxy_buffer_size 64k;
proxy_busy_buffers_size 96k;
proxy_temp_file_write_size 96k;
proxy_cache_key "$scheme://$host$request_uri";
fastcgi_cache_path /var/lib/nginx/cache/fastcgi levels=1:2 keys_zone=FCGICACHE:100m max_size=1200m inactive=60m;
fastcgi_temp_path /var/lib/nginx/cache/fastcgi_tmp;
fastcgi_cache_key "$scheme$request_method$host$request_uri";
fastcgi_cache_use_stale error timeout invalid_header http_500;
fastcgi_send_timeout 30;
fastcgi_read_timeout 30;
fastcgi_buffers 8 256k;
fastcgi_buffer_size 256k;
fastcgi_busy_buffers_size 256k;
limit_req_zone $binary_remote_addr zone=wplogin:10m rate=10r/m;
open_file_cache_errors off;
open_file_cache max=10000 inactive=60s;
map $http_cookie $no_cache {
default 0;
~SESS 1;
~wordpress_logged_in 1;
}
map $request_method $no_cache {
default 0;
POST 1;
}
map $http_x_requested_with $nocache {
default 0;
XMLHttpRequest 1;    
}
proxy_no_cache $no_cache;
proxy_cache_bypass $no_cache;
fastcgi_no_cache $no_cache;
fastcgi_cache_bypass $no_cache;
add_header X-Frame-Options "sameorigin" always;
#add_header X-Xss-Protection "1; mode=block" always;
#add_header X-Content-Type-Options "nosniff" always;
#add_header X-Download-Options "noopen" always;
#add_header X-Permitted-Cross-Domain-Policies "master-only" always;
include /etc/nginx/conf.d/*.conf;
include /etc/nginx/blacklist.conf;
}
